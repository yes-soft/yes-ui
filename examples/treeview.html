<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Builder example</title>
    <link rel="stylesheet" href="../components/yes-bundle/dist/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../components/yes-bundle/dist/vendor/bootstrap/css/bootstrap-theme.min.css">
</head>
<body ng-app="app">

<div ng-controller="demo">
    <div tree-view></div>
</div>

<script src="../components/yes-bundle/dist/yes.bundle.min.js" charset="utf-8"></script>
<script src="../components/yes-utils/dist/yes.utils.js" charset="utf-8"></script>
<script src="../dist/yes.ui.dependencies.js" charset="utf-8"></script>

<script type="text/javascript">


    angular.module('app', ['yes.utils'])
            .run(function ($templateCache) {
                // $templateCache.put('./../src/templates/tree-node.html', '<h1>scaffold {{world}}</h1>');
            })
            .directive('treeView', function ($compile, $templateRequest, $http, utils) {
                return {
                    link: function (scope, element, attrs) {

                        $templateRequest("./../src/templates/tree-node.html").then(function (html) {
                            var render = function (source) {
                                console.log('start render ...');
                                walk(source);
                                element[0].appendChild(wrap);
                                $compile(element.children())(scope);
                            };
                            scope.$watch('menus', function (source) {
                                if (source) {
                                    render(source);
                                }
                            });

                            var template = element.html(html);
                            console.log(template);

                            var wrap = document.createDocumentFragment();
                            var depth = 0;
                            var walk = function (tree) {
                                angular.forEach(tree, function (node) {
                                    var div = document.createElement("div");
//                                    var name = '-----------------------'.substring(0, depth * 4) + node.name + node.type;
//                                    var txt = document.createTextNode(name);
                                    var current = depth;
                                    // div.appendChild(txt);
                                     // wrap.appendChild(angular.copy(template[0]));

                                    div.innerHTML = html;

                                    while (div.childNodes.length > 0) {
                                        wrap.appendChild(div.childNodes[0]);
                                        console.log(div.childNodes.length);
                                    }

                                    if (node.subMenus) {
                                        depth++;
                                        walk(node.subMenus);
                                    }
                                    depth = current;
                                });
                            };
                            $compile(element.children())(scope);
                        });
                    }
                };
            })
            .controller('demo', function ($http, $scope, utils) {
                $http.get('data/menus.json').success(function (data) {
                    $scope.menus = utils.menus.initMenus(null, data.body.items);
                });
            })

</script>
</body>
</html>
